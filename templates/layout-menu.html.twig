{### menu ###}
{% set page_route = app.request.attributes.get('_route') %}

{% macro opzione(opt,route) %}
  <li class="nav-item" role="none">
    <a class="nav-link{{ opt.disab ? ' disabled' }}{{ route == opt.url ? ' active' }}" role="menuitem" href="{{ opt.url ? path(opt.url) : '#' }}" title="{{ opt.desc|raw }}"{{ opt.disab ? '  aria-disabled="true"' }}>
  {% if opt.icona %}
      <svg class="icon icon-sm icon-{{ route == opt.url ? 'primary' : 'white' }} d-none d-lg-block mr-2">
        <use xlink:href="{{ asset('vendor/bootstrap-italia/svg/sprite.svg') }}#{{ opt.icona }}"></use>
      </svg>
  {% endif %}
      <span>{{ opt.nome|raw }}</span>{% if route == opt.url %}<span class="sr-only"> attivo</span>{% endif %}
    </a>
  </li>
{% endmacro %}

{% macro subopzione(opt,route) %}
  <li role="none">
    <a class="list-item{{ opt.disab ? ' disabled' }}{{ route == opt.url ? ' active' }}" role="menuitem" href="{{ opt.url ? path(opt.url) : '#' }}" title="{{ opt.desc|raw }}"{{ opt.disab ? '  aria-disabled="true"' }}>
      <span>{{ opt.nome|raw }}</span>{% if route == opt.url %}<span class="sr-only"> attivo</span>{% endif %}
    </a>
  </li>
{% endmacro %}

{% macro menu(opt,route) %}
  <li class="nav-item dropdown" role="none">
    <a class="nav-link dropdown-toggle px-3{{ opt.disab ? ' disabled' }}{{ route in opt.suburl ? ' active' }}" role="menuitem" href="#" title="{{ opt.desc|raw }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"{{ opt.disab ? '  aria-disabled="true"' }}>
      <span>{{ opt.nome|raw }}</span>
      <svg class="icon icon-xs icon-{{ route in opt.suburl ? 'primary' : 'white' }}">
        <use xlink:href="{{ asset('vendor/bootstrap-italia/svg/sprite.svg') }}#it-expand"></use>
      </svg>{% if route in opt.suburl %}<span class="sr-only"> attivo</span>{% endif %}
    </a>
    <div class="dropdown-menu">
      <div class="link-list-wrapper">
        <ul class="link-list" role="menu" aria-label="{{ opt.desc|raw }}">
  {% for subopt in opt.sub %}
    {% if subopt.sub %}
      {{ _self.menu(subopt,route) }}
    {% else %}
      {{ _self.subopzione(subopt,route)  }}
    {% endif %}
  {% endfor %}
        </ul>
      </div>
    </div>
  </li>
{% endmacro %}

{% macro megamenu(opt,route) %}
  <li class="nav-item dropdown megamenu" role="none">
    <a class="nav-link dropdown-toggle{{ opt.disab ? ' disabled' }}{{ route in opt.suburl ? ' active' }}" role="menuitem" href="#" title="{{ opt.desc|raw }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"{{ opt.disab ? '  aria-disabled="true"' }}>
      <span>{{ opt.nome|raw }}</span>
      <svg class="icon icon-xs icon-{{ route in opt.suburl ? 'primary' : 'white' }}">
        <use xlink:href="{{ asset('vendor/bootstrap-italia/svg/sprite.svg') }}#it-expand"></use>
      </svg>{% if route in opt.suburl %}<span class="sr-only"> attivo</span>{% endif %}
    </a>
    <div class="dropdown-menu">
      <div class="row">
  {% set num = 12 // (opt.sub|length) %}
  {% for submenu in opt.sub %}
        <div class="col-12 col-lg-{{ num }}">
          <div class="link-list-wrapper">
            <ul class="link-list" role="menu" aria-label="{{ submenu.desc|raw }}">
              <li role="none"><h3 class="no_toc">{{ submenu.nome|raw }}</h3></li>
    {% for subopt in submenu.sub %}
      {{ _self.subopzione(subopt,route)  }}
    {% endfor %}
            </ul>
          </div>
        </div>
  {% endfor %}
      </div>
    </div>
  </li>
{% endmacro %}

<nav class="navbar navbar-expand-lg{{ app.session.get('/CONFIG/MENU/main').mega ? ' has-megamenu' }} pl-0" aria-label="{{ app.session.get('/CONFIG/MENU/main').nome }}">
  <button class="custom-navbar-toggler bg-primary" type="button" aria-controls="gs-mainmenu" aria-expanded="false" aria-label="{{ app.session.get('/CONFIG/MENU/main').desc }}" data-target="#gs-mainmenu">
    <svg class="icon">
      <use xlink:href="{{ asset('vendor/bootstrap-italia/svg/sprite.svg') }}#it-burger"></use>
    </svg>
  </button>
  <div id="gs-mainmenu" class="navbar-collapsable" style="display:none;">
    <div class="overlay" style="display:none;"></div>
    <div class="close-div sr-only">
      <button class="btn close-menu" type="button"><span class="it-close"></span>Chiudi</button>
    </div>
    <div class="menu-wrapper">
      <ul class="navbar-nav" role="menubar" aria-label="{{ app.session.get('/CONFIG/MENU/main').nome }}">
{% for opt in app.session.get('/CONFIG/MENU/main').opzioni %}
  {% if opt.mega and opt.sub %}
    {{ _self.megamenu(opt,page_route)  }}
  {% elseif opt.sub %}
    {{ _self.menu(opt,page_route)  }}
  {% else %}
    {{ _self.opzione(opt,page_route)  }}
  {% endif %}
{% endfor %}
      </ul>
    </div>
  </div>
</nav>
{### FINE menu ###}
