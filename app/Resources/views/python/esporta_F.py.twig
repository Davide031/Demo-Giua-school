#!/usr/bin/env python
# -*- coding: utf-8 -*-


from argolib import ArgoDriver


def main():

  ### classe = [anno, sezione, percorso]
  classe = ["{{ classe.anno }}", "{{ classe.sezione }}", "{{ percorso }}"]

  ### voti[materia] = [ [alunno, nascita, voto, assenze], ... ]
  voti = {}

{% for materia,m in dati.materie %}
  voti["{{ m.nome|raw }}"] = [
{% for alunno,a in dati.alunni %}
{% if a.estero %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", ""],
{% elseif dati.no_scrutinabili[alunno] is defined and dati.no_scrutinabili[alunno] == 'C' %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", ""],
{% elseif dati.no_scrutinabili[alunno] is defined and dati.no_scrutinabili[alunno] == 'A' %}
{% if m.tipo == 'R' and a.religione == 'S'%}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", "{{ dati.voti[alunno][materia].assenze }}"],
{% elseif m.tipo == 'N' %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", "{{ dati.voti[alunno][materia].assenze }}"],
{% else %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", ""],
{% endif %}
{% else %}
{% if m.tipo == 'R' and a.religione != 'S' %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", ""],
{% elseif m.tipo == 'C' %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "{{ dati.voti[alunno][materia].unico }}", ""],
{% else %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "{{ dati.voti[alunno][materia].unico }}", "{{ dati.voti[alunno][materia].assenze }}"],
{% endif %}
{% endif %}
{% endfor %}
    ]
{% endfor %}

  ### esito = [ [alunno, nascita, credito, creditoprec, media, esito], ...]
  esito = [
{% for alunno,a in dati.alunni %}
{% if a.estero %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", "", "", ""],
{% elseif dati.no_scrutinabili[alunno] is defined and dati.no_scrutinabili[alunno] == 'C' %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", "", "", "NS"],
{% elseif dati.no_scrutinabili[alunno] is defined and dati.no_scrutinabili[alunno] == 'A' %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "", "", "", "N"],
{% elseif classe.anno < 3 %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "{{ dati.medie[alunno] }}", "", "", "{{ dati.esiti[alunno].esito }}"],
{% else %}
      ["{{ (a.cognome~' '~a.nome)|raw }}", "{{ a.dataNascita }}", "{{ dati.medie[alunno] }}", "{{ dati.esiti[alunno].credito }}", "{{ dati.esiti[alunno].creditoprec }}", "{{ dati.esiti[alunno].esito }}"],
{% endif %}
{% endfor %}
    ]

  ### esegue programma
  ad = ArgoDriver(debug="SCREEN", logpath=classe[2], logfile=classe[0]+classe[1]+"-GS")
  ad.importaFinale(classe[0], classe[1], voti, esito)
  ad.controllaFinale(classe[0], classe[1], voti, esito)


if __name__ == "__main__":
  main()

